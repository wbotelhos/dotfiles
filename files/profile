# ENVIRONMENT

export EDITOR='atom --wait'
export GIT_EDITOR=/usr/bin/vim

export LANG=en_US.UTF-8
export LC_COLLATE=en_US
export LC_MESSAGES=en_US
export LC_MONETARY=en_US
export LC_NUMERIC=en_US
export LC_TIME=en_US

export GECKODRIVER_HOME=~/development
export JAVA_HOME=$(/usr/libexec/java_home)
export M2_HOME=~/development/apache-maven-3.3.9
export MONGO_HOME=/usr/local/mongodb
export MYSQL_HOME=/usr/local/mysql
export NVM_DIR="${HOME}/.nvm"
export POSTGRES_HOME=/Applications/Postgres.app/Contents/Versions/9.4
export REDIS_HOME=/usr/local/redis
export RVM_HOME=~/.rvm
export TOMCAT_HOME=/usr/local/tomcat

export PATH=${PATH}:${GECKODRIVER_HOME}:${JAVA_HOME}/bin:${MONGO_HOME}/bin:${MYSQL_HOME}/bin:${REDIS_HOME}/src:${TOMCAT_HOME}/bin:${RVM_HOME}/bin:${POSTGRES_HOME}/bin:${M2_HOME}/bin

# ALIAS

alias ...='cd ../..'
alias ..='cd ..'
alias .='cd .'
alias cap='bundle exec cap'
alias capfull='git push && git push --tags && bundle exec cap production deploy && cap production db:migrate && cap production db:seed'
alias capush='git push && git push --tags && bundle exec cap production deploy'
alias chrome='open /Applications/Google\ Chrome.app'
alias clean_hosts='echo '' > ~/.ssh/known_hosts'
alias cls='clear'
alias dev='cd ~/Development'
alias firefox='open /Applications/Firefox.app'
alias flush_memcached="echo 'flush_all' | nc 127.0.0.1 11211"
alias folders='ls -Gal | grep ^d'
alias hclear='history -c'
alias hide_files='defaults write com.apple.finder AppleShowAllFiles NO; killall Finder'
alias ip='curl ifconfig.me'
alias kill='kill -9'
alias killnautilus='killall -9 nautilus'
alias la='ls -lah'
alias lt='lt --port 3000 --subdomain danca'
alias ports='sudo lsof -i -n -P'
alias psj='jps -l'
alias psx='ps aux | grep'
alias show_files='defaults write com.apple.finder AppleShowAllFiles YES; killall Finder'
alias sizes='find / -xdev -type f -size +100M -exec du -sh {} ";" | sort -rh | head -n50'
alias speedup='sudo find /private/var/log/asl/* -mtime +5 -exec rm -rf {} \;'
alias ss='open /System/Library/Frameworks/ScreenSaver.framework/Resources/ScreenSaverEngine.app'
alias stremio='cd /Users/wbotelhos/Library/Application\ Support/stremio/stremio-cache'
alias upgrade='sudo apt-get update && sudo apt-get upgrade && sudo apt-get clean'
alias work='cd ~/workspace'

## GIT

alias describe='git describe'
alias fetch='git fetch --all; git fetch --tag'
alias ga='git add -A && git commit -m'
alias gb='git branch'
alias gc='git commit'
alias gd='git difftool -y -x "sdiff" | less'
alias gg='gitg &'
alias gk='git checkout'
alias gl="git log --pretty=format:'%Cred%h%Creset%C(yellow)%d%Creset %s %Cgreen(%cr) %C(cyan  )<%an>%Creset' --abbrev-commit"
alias gm='git merge'
alias gs='git status -sb'
alias master='git checkout master'
alias pop='git stash pop'
alias pull='git pull'
alias push='git push && git push --tags'
alias rebase...='git rebase --continue'
alias rebase='git add -A && git stash && git pull --rebase'
alias remote='git config remote.origin.url'
alias stash='git add -A && git stash'

## JS

alias hbs='gulp hbs'
alias jasmine='node_modules/jasmine-node/bin/jasmine-node --forceexit'
alias jasmine2='node_modules/jasmine-node/bin/jasmine-node --forceExit'

## RUBY

alias be='bundle exec'
alias bi='bundle install'
alias cucumber='bundle exec cucumber'
alias gemup='gem update --system && gem install bundler'
alias migrate='DATA_MIGRATER=false rake db:migrate'
alias prepare='DATA_MIGRATER=false rake db:test:prepare'
alias r='BROWSER=chrome_headless RAILS_MAX_THREADS=1 bundle exec rspec'
alias rake='bundle exec rake'
alias rc='rails c'
alias route='rake routes | grep'
alias rr='RAILS_MAX_THREADS=1 bundle exec rspec'
alias rs='BULLET=true rails s'
alias rspec='bundle exec rspec'
alias schema='DATA_MIGRATER=false rake db:schema:load'
alias seed='DATA_MIGRATER=false rake db:seed'
alias spec='bundle exec rspec spec'

# JOB

source ~/.job

# RVM

source ~/.rvm/scripts/rvm

# NVM

source /usr/local/opt/nvm/nvm.sh

# PROMPT

prompt() {
  local CYAN="\[\033[0;36m\]"
  local LIGHT_GREEN="\[\033[1;32m\]"
  local NO_COLOR="\[\e[0m\]"
  local YELLOW="\[\033[0;33m\]"

  local BRANCH=`git branch 2> /dev/null | grep \* | sed 's/* //'`
  local RUBY_VERSION=$(~/.rvm/bin/rvm-prompt v)

  PS1="${CYAN}\w\a${NO_COLOR} (${RUBY_VERSION}) ${LIGHT_GREEN}[${BRANCH}]\n${YELLOW}\$ ${NO_COLOR}"
}

PROMPT_COMMAND=prompt

# METHODS

bu() {
  [ `uname` == 'Linux' ]  && number_of_cores=`nproc`
  [ `uname` == 'Darwin' ] && number_of_cores=`sysctl -n hw.ncpu`

  bundle update --jobs `expr $number_of_cores - 1`
}

clone() {
  git clone git@github.com:${1}/${2}
}

deploy() {
  ./script/codedeploy/deploy.sh "${1}"
}

go() {
  cd ~/workspace/${1}
}

guard() {
  if [ ! -z "${1}" ]; then
    cd ~/workspace/${1}
  fi

  bundle exec guard
}

hsts() {
  curl https://hstspreload.com/api/v1/status/${1}
}

keygen() {
  KEY_PATH=~/.ssh/"${1}"
  EMAIL=${2}

  ssh-keygen -t rsa -b 4096 -f $KEY_PATH -C $2
  chmod 600 $KEY_PATH
  ssh-add $KEY_PATH
  cat "${KEY_PATH}.pub"
}

merge_theirs() {
  BRANCH=$1

  git merge --strategy recursive -X theirs $BRANCH
}

reload() {
  BASH_PROFILE=~/.bash_profile
  BASHRC=~/.bashrc
  JOB=~/.job
  PROFILE=~/.profile

  [ -f $BASH_PROFILE ] && source $BASH_PROFILE
  [ -f $BASHRC ]       && source $BASHRC
  [ -f $JOB ]          && source $JOB
  [ -f $PROFILE ]      && source $PROFILE
}

redo() {
  STEP=1

  if [ ! -z "${1}" ]; then
    STEP=${1}
  fi

  rake db:rollback STEP=${STEP} && rake db:migrate
}

rollback() {
  STEP=1

  if [ ! -z "${1}" ]; then
    STEP=${1}
  fi

  DATA_MIGRATER=false rake db:rollback STEP=${STEP}
}

rsp() {
  if [ ! -z "${1}" ]; then
    BULLET=true bundle exec rails s -p $1
  else
    BULLET=true bundle exec rails s -p 3001
  fi
}

tag() {
  git tag -a "${1}" -m "${1}"

  echo "Now your project is on version '`git describe`'"
}

tag_remove() {
  git tag -d "${1}" && git push origin ":refs/tags/${1}"

  echo "Removed tag ${1}. Now your project is on version '`git describe`'"
}
